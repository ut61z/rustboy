# Phase 3: 最小限CPU実装 - チェックリスト

## 🎯 目標
BootROMの最初の数命令を実行できる最小限のCPUを実装する

## 📋 実装項目

### 1. CPUレジスタシステム強化
- [ ] **完全なレジスタ実装**
  - [ ] 8bitレジスタ (A, B, C, D, E, F, H, L)
  - [ ] 16bitレジスタペア (AF, BC, DE, HL, SP, PC)
  - [ ] フラグレジスタ操作 (Z, N, H, C)
  - [ ] レジスタアクセサ関数

### 2. 命令フェッチサイクル
- [ ] **基本フェッチ機能**
  - [ ] PCからオペコード読み取り
  - [ ] PC自動インクリメント
  - [ ] 命令長の管理

### 3. 命令デコーダ
- [ ] **オペコード解析**
  - [ ] 基本命令のデコード
  - [ ] CB prefixed命令対応
  - [ ] エラーハンドリング

### 4. 基本命令実装
- [ ] **必須命令**
  - [ ] `0x00` NOP (何もしない)
  - [ ] `0x3E` LD A, n (Aレジスタに即値ロード)
  - [ ] `0x06` LD B, n (Bレジスタに即値ロード)
  - [ ] `0x0E` LD C, n (Cレジスタに即値ロード)
  - [ ] `0x16` LD D, n (Dレジスタに即値ロード)
  - [ ] `0x1E` LD E, n (Eレジスタに即値ロード)
  - [ ] `0x26` LD H, n (Hレジスタに即値ロード)
  - [ ] `0x2E` LD L, n (Lレジスタに即値ロード)

- [ ] **ジャンプ命令**
  - [ ] `0xC3` JP nn (絶対ジャンプ)
  - [ ] `0x18` JR n (相対ジャンプ)

- [ ] **スタック操作**
  - [ ] `0x31` LD SP, nn (スタックポインタ設定)

### 5. CPU実行ループ
- [ ] **メインループ**
  - [ ] fetch → decode → execute サイクル
  - [ ] 命令実行カウンタ
  - [ ] デバッグ出力

### 6. テストとデバッグ
- [ ] **単体テスト**
  - [ ] レジスタ操作テスト
  - [ ] 各命令の動作テスト
  - [ ] フラグ操作テスト

- [ ] **統合テスト**
  - [ ] 簡単なプログラム実行
  - [ ] BootROM最初の数命令実行
  - [ ] デバッグ情報出力

## 🚀 実装順序

### Step 1: CPUコア構造
1. `src/cpu/mod.rs` - CPUモジュール統合
2. `src/cpu/registers.rs` - レジスタシステム
3. `src/cpu/instructions.rs` - 命令定義

### Step 2: 命令システム
1. フェッチサイクル実装
2. デコーダ実装  
3. 基本命令実装

### Step 3: 統合とテスト
1. メインループ統合
2. テストプログラム作成
3. BootROM実行テスト

## ✅ 完了判定基準

### 最小限の成功条件
- [ ] NOP命令が実行できる
- [ ] LD A, n 命令が実行できる
- [ ] JP nn 命令が実行できる
- [ ] 簡単なプログラムループが実行できる

### 理想的な完了条件
- [ ] BootROMの最初の10命令が実行できる
- [ ] レジスタ状態がデバッグ出力される
- [ ] 命令実行トレースが出力される
- [ ] 全テストがパスする

## 📁 新規作成ファイル

```
src/cpu/
├── mod.rs           # CPUモジュール統合
├── registers.rs     # レジスタシステム
├── instructions.rs  # 命令実装
├── decoder.rs       # 命令デコーダ
└── tests.rs         # CPUテスト
```

## 🕐 予想所要時間
- **Step 1**: 1-2時間 (レジスタシステム)
- **Step 2**: 2-3時間 (命令システム)
- **Step 3**: 1時間 (統合・テスト)
- **合計**: 4-6時間

## 🎉 Phase 3完了後に獲得できるスキル
- CPUアーキテクチャの理解
- 命令セットアーキテクチャ (ISA) の実装
- フェッチ・デコード・実行サイクル
- アセンブリ言語とマシン語の関係
- ハードウェアエミュレーションの基礎
